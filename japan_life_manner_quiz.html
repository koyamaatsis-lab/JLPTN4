<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>留学生向け 日本の生活マナークイズ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-green-100 min-h-screen p-2">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-xl shadow-xl p-4 mb-2">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h1 class="text-xl font-bold text-gray-800">日本の生活マナー</h1>
                </div>
                <button onclick="resetApp()" class="p-1.5 hover:bg-gray-100 rounded-lg transition">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                </button>
            </div>

            <div class="flex gap-2 mb-3">
                <button id="learnBtn" onclick="changeMode('learn')" class="flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-green-600 text-white">
                    学習モード
                </button>
                <button id="quizBtn" onclick="changeMode('quiz')" class="flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                    クイズモード
                </button>
            </div>

            <div class="mb-3">
                <div class="flex justify-between text-xs text-gray-600 mb-1">
                    <span id="progressText">1 / 30</span>
                    <span id="scoreText"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5">
                    <div id="progressBar" class="bg-green-600 h-1.5 rounded-full transition-all duration-300" style="width: 3.33%"></div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-xl p-6 mb-3">
                <div id="categoryBadge" class="inline-block px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full mb-3">在留・法律</div>
                <div id="questionText" class="text-xl font-bold text-green-900 mb-3 leading-relaxed">在留カードはどうしますか？</div>
                <div id="answerArea" class="space-y-2"></div>
            </div>

            <div id="buttonArea"></div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-2 text-center text-xs text-gray-600">
            <p>全30問 | 留学生向け生活マナー</p>
        </div>
    </div>

    <script>
        const questions = [
            // 在留・法律
            { category: '在留・法律', question: '在留カードはどうしますか？', answer: 'いつも持つ', options: ['家におく', 'いつも持つ', 'なくしてもいい'], explanation: '在留カードは常に携帯する義務があります。外出時は必ず持ちましょう。', chinese: '在留卡必须随身携带。外出时一定要带着。' },
            { category: '在留・法律', question: '住所が変わったときは？', answer: '市役所にとどける', options: ['何もしない', '市役所にとどける', '友達に言う'], explanation: '住所変更から14日以内に市区町村役場で届け出る必要があります。', chinese: '地址变更后需要在14天内到市区町村役所办理登记。' },
            { category: '在留・法律', question: '在留カードをなくしたら？', answer: 'すぐ先生や警察に相談', options: ['そのまま', 'すぐ先生や警察に相談', '帰国する'], explanation: '紛失したら速やかに警察に届け出て、入国管理局で再交付申請をしましょう。', chinese: '遗失后要尽快向警察报案，并到入国管理局申请补发。' },
            { category: '在留・法律', question: '他人に在留カードをかすのは？', answer: 'だめ', options: ['OK', 'だめ', '家族ならOK'], explanation: '在留カードの貸与は違法です。絶対にしてはいけません。', chinese: '出借在留卡是违法的，绝对不可以。' },
            
            // アルバイト
            { category: 'アルバイト', question: 'アルバイトは週何時間まで？', answer: '28時間', options: ['20時間', '28時間', '40時間'], explanation: '留学生は原則週28時間まで。長期休暇中は1日8時間までアルバイトができます。', chinese: '留学生原则上每周最多28小时。长期假期中每天最多8小时。' },
            { category: 'アルバイト', question: '28時間をこえると？', answer: 'VISA更新ができない', options: ['問題ない', 'VISA更新ができない', '給料がふえる'], explanation: '時間超過は資格外活動違反となり、在留資格の更新や変更ができなくなります。', chinese: '超时属于资格外活动违规，会导致无法更新或变更在留资格。' },
            { category: 'アルバイト', question: 'してはいけないアルバイトは？', answer: 'あぶない店', options: ['コンビニ', 'レストラン', 'あぶない店'], explanation: '風俗営業関連の仕事は法律で禁止されています。', chinese: '与风俗业相关的工作是法律禁止的。' },
            
            // ごみ・生活
            { category: 'ごみ・生活', question: 'ごみはどうしますか？', answer: 'ルールを守って出す', options: ['いつでも出す', 'ルールを守って出す', 'まとめて出す'], explanation: '各地域のごみ出しルール（曜日、時間、分別方法）を必ず守りましょう。', chinese: '必须遵守各地区的垃圾投放规则（日期、时间、分类方法）。' },
            { category: 'ごみ・生活', question: 'ごみを分別しないと？', answer: '近所から苦情がくる', options: ['問題ない', '近所から苦情がくる', 'ポイントがもらえる'], explanation: 'ごみの分別をしないと近所トラブルになり、回収してもらえない場合もあります。', chinese: '不分类垃圾会引起邻里纠纷，也可能不被回收。' },
            { category: 'ごみ・生活', question: '夜おそくに大きい音を出すのは？', answer: 'だめ', options: ['OK', 'だめ', '週末ならOK'], explanation: '夜10時以降の騒音は近所迷惑です。特に集合住宅では注意が必要です。', chinese: '晚上10点以后发出噪音会打扰邻居。特别是在公寓里要注意。' },
            
            // 電車・公共マナー
            { category: '電車・公共', question: '電車の中で正しい行動は？', answer: '静かにする', options: ['大声で話す', '静かにする', '走る'], explanation: '電車内では静かに過ごすのがマナーです。大声での会話は控えましょう。', chinese: '在电车内安静度过是礼仪。请避免大声交谈。' },
            { category: '電車・公共', question: '電車で電話は？', answer: '静かにする', options: ['大きな声で話す', '静かにする', 'ずっと話す'], explanation: '電車内での通話は避け、マナーモードに設定しましょう。緊急時は小声で短く。', chinese: '避免在电车内打电话，设置为静音模式。紧急时请小声简短。' },
            { category: '電車・公共', question: '駅のホームで走るのは？', answer: 'あぶない', options: ['安全', 'あぶない', 'おすすめ'], explanation: 'ホームでの走行は転落事故の危険があります。時間に余裕を持って行動しましょう。', chinese: '在站台上跑步有跌落事故的危险。请留出充足时间行动。' },
            
            // 自転車・交通
            { category: '自転車・交通', question: '自転車でスマホを使うと？', answer: 'ばっきんやしょばつがある', options: ['便利', 'ばっきんやしょばつがある', '問題ない'], explanation: '自転車運転中のスマホ使用は違反です。罰金や処罰の対象になります。', chinese: '骑自行车时使用手机是违规的，会被罚款或处罚。' },
            { category: '自転車・交通', question: '自転車のライトは？', answer: '夜はつける', options: ['いらない', '夜はつける', '昼だけつける'], explanation: '夜間の無灯火運転は違反です。暗くなったら必ずライトをつけましょう。', chinese: '夜间无灯行驶是违规的。天黑后必须开灯。' },
            { category: '自転車・交通', question: '赤信号で自転車は？', answer: '止まる', options: ['進む', '止まる', '少しならOK'], explanation: '自転車も車両です。信号を守り、必ず止まりましょう。', chinese: '自行车也是车辆。必须遵守信号灯停车。' },
            
            // お金・買い物
            { category: 'お金・買い物', question: 'コンビニで万引きは？', answer: 'だめ', options: ['OK', 'だめ', '少しならOK'], explanation: '万引きは窃盗罪という犯罪です。絶対にしてはいけません。', chinese: '偷窃是犯罪行为，绝对不可以。' },
            { category: 'お金・買い物', question: 'レシートはいらないときは？', answer: 'もらわないと言う', options: ['店にすてる', 'もらわないと言う', '床におく'], explanation: '不要な場合は「レシートは結構です」と伝えましょう。ゴミ箱に捨てるのもマナー違反です。', chinese: '不需要时请说"不需要收据"。扔在店里的垃圾桶也是不礼貌的。' },
            
            // たばこ・お酒
            { category: 'たばこ・お酒', question: '日本でお酒を飲めるのは？', answer: '20歳以上', options: ['18歳以上', '20歳以上', '年齢は関係ない'], explanation: '日本では20歳未満の飲酒は法律で禁止されています。', chinese: '日本法律禁止20岁以下饮酒。' },
            { category: 'たばこ・お酒', question: '20歳未満のお酒は？', answer: 'だめ', options: ['OK', 'だめ', '少しならOK'], explanation: '20歳未満の飲酒は違法です。少量でも禁止されています。', chinese: '20岁以下饮酒是违法的，即使少量也禁止。' },
            { category: 'たばこ・お酒', question: '決められていない場所でのたばこは？', answer: 'だめ', options: ['OK', 'だめ', '夜ならOK'], explanation: '路上喫煙や指定場所以外での喫煙は禁止されている地域が多くあります。', chinese: '很多地区禁止在路上或指定场所以外吸烟。' },
            
            // 物・犯罪防止
            { category: '物・犯罪防止', question: '道で財布を拾ったら？', answer: '交番へとどける', options: ['使う', '交番へとどける', '家に持つ'], explanation: '拾得物は交番や警察署に届けましょう。使用すると犯罪になります。', chinese: '拾到的东西要交到派出所或警察局。使用的话会构成犯罪。' },
            { category: '物・犯罪防止', question: '人の自転車を勝手に使うのは？', answer: 'だめ', options: ['OK', 'だめ', '近くならOK'], explanation: '他人の自転車の無断使用は窃盗罪です。絶対にしてはいけません。', chinese: '擅自使用他人自行车是盗窃罪，绝对不可以。' },
            { category: '物・犯罪防止', question: '知らない人の荷物を受け取るのは？', answer: 'だめ', options: ['OK', 'だめ', 'たのまれたらOK'], explanation: '知らない人の荷物の受け取りや運搬は犯罪に巻き込まれる危険があります。断りましょう。', chinese: '接收或运送陌生人的物品有卷入犯罪的危险。请拒绝。' },
            
            // 連絡・相談
            { category: '連絡・相談', question: '困ったときは？', answer: '先生や相談先に相談', options: ['一人で考える', '先生や相談先に相談', '何もしない'], explanation: '困ったことがあれば、学校の先生や留学生相談窓口に相談しましょう。', chinese: '有困难时请向学校老师或留学生咨询窗口咨询。' },
            { category: '連絡・相談', question: '日本のルールがわからないときは？', answer: '聞く・調べる', options: ['無視する', '聞く・調べる', '友達だけに聞く'], explanation: 'わからないことは積極的に質問し、正確な情報を得ましょう。', chinese: '不懂的事情要积极询问，获取准确信息。' },
            
            // 追加問題
            { category: '在留・法律', question: 'パスポートの有効期限が切れたら？', answer: 'すぐに大使館で更新', options: ['気にしない', 'すぐに大使館で更新', '帰国してから'], explanation: 'パスポートは常に有効な状態を保つ必要があります。', chinese: '护照必须保持有效状态。' },
            { category: 'アルバイト', question: '資格外活動許可なしでアルバイトは？', answer: '違法', options: ['OK', '違法', '少しならOK'], explanation: '留学ビザでアルバイトするには資格外活動許可が必要です。', chinese: '持留学签证打工需要获得资格外活动许可。' },
            { category: 'ごみ・生活', question: '粗大ごみはどうする？', answer: '市に連絡して予約', options: ['普通のごみと一緒', '市に連絡して予約', '道に置く'], explanation: '粗大ごみは事前予約と手数料が必要です。各自治体のルールに従いましょう。', chinese: '大件垃圾需要提前预约并支付手续费。请遵守各自治体的规定。' },
            { category: '自転車・交通', question: '自転車の二人乗りは？', answer: '違反', options: ['OK', '違反', '近くならOK'], explanation: '自転車の二人乗りは原則禁止です（幼児用座席は除く）。', chinese: '自行车载人原则上禁止（儿童座椅除外）。' },
            { category: 'お金・買い物', question: '支払いができないときは？', answer: '店に相談', options: ['逃げる', '店に相談', '後で払う'], explanation: '支払いができない場合は正直に店員に相談しましょう。', chinese: '无法付款时要诚实地向店员咨询。' }
        ];

        let currentIdx = 0;
        let appMode = 'learn';
        let correctCount = 0;
        let totalCount = 0;
        let isAnswered = false;
        let userAnswer = null;
        let shuffledOptions = [];

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function render() {
            const q = questions[currentIdx];
            document.getElementById('categoryBadge').textContent = q.category;
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('progressText').textContent = `${currentIdx + 1} / ${questions.length}`;
            document.getElementById('progressBar').style.width = `${((currentIdx + 1) / questions.length) * 100}%`;
            
            if (appMode === 'quiz' && totalCount > 0) {
                document.getElementById('scoreText').textContent = `正解率: ${Math.round((correctCount / totalCount) * 100)}%`;
            } else {
                document.getElementById('scoreText').textContent = '';
            }

            if (appMode === 'learn') {
                document.getElementById('answerArea').innerHTML = `
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="text-xl text-green-700 font-bold mb-2">✓ ${q.answer}</div>
                        <div class="text-sm text-gray-700 leading-relaxed mb-2">${q.explanation}</div>
                        <div class="text-sm text-blue-600 leading-relaxed">${q.chinese}</div>
                    </div>
                `;
            } else if (isAnswered) {
                document.getElementById('answerArea').innerHTML = `
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <div class="text-xl text-green-700 font-bold mb-2">✓ ${q.answer}</div>
                        <div class="text-sm text-gray-700 leading-relaxed mb-2">${q.explanation}</div>
                        <div class="text-sm text-blue-600 leading-relaxed">${q.chinese}</div>
                    </div>
                `;
            } else {
                document.getElementById('answerArea').innerHTML = '';
            }

            renderButtons();
        }

        function renderButtons() {
            const q = questions[currentIdx];
            const btnArea = document.getElementById('buttonArea');
            
            if (appMode === 'learn') {
                btnArea.innerHTML = `
                    <div class="flex gap-2">
                        <button onclick="goPrev()" ${currentIdx === 0 ? 'disabled' : ''} 
                            class="flex-1 py-2 px-4 text-sm bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed transition">
                            前へ
                        </button>
                        <button onclick="goNext()" ${currentIdx === questions.length - 1 ? 'disabled' : ''} 
                            class="flex-1 py-2 px-4 text-sm bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition">
                            次へ
                        </button>
                    </div>
                `;
            } else {
                if (!isAnswered) {
                    if (shuffledOptions.length === 0) {
                        shuffledOptions = shuffleArray(q.options);
                    }
                    btnArea.innerHTML = `
                        <div class="space-y-2">
                            <p class="text-center text-sm text-gray-600 mb-2">正しい答えを選んでください</p>
                            <div class="space-y-2">
                                ${shuffledOptions.map(opt => `
                                    <button onclick="selectAnswer('${opt.replace(/'/g, "\\'")}')" 
                                        class="w-full py-3 px-4 text-base bg-green-100 text-green-900 rounded-lg font-medium hover:bg-green-200 transition text-left">
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else if (userAnswer === q.answer) {
                    btnArea.innerHTML = `
                        <div class="text-center">
                            <div class="text-lg font-bold text-green-600">✓ 正解!</div>
                        </div>
                    `;
                } else {
                    btnArea.innerHTML = `
                        <div class="space-y-2">
                            <div class="text-center">
                                <div class="text-lg font-bold text-red-600 mb-1">✗ 不正解</div>
                                <div class="text-base text-gray-700 mb-2">
                                    正解: <span class="text-green-700 font-semibold text-lg">${q.answer}</span>
                                </div>
                            </div>
                            <button onclick="retry()" 
                                class="w-full py-2 px-4 text-sm bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">
                                もう一度挑戦
                            </button>
                        </div>
                    `;
                }
            }
        }

        function changeMode(newMode) {
            appMode = newMode;
            isAnswered = false;
            userAnswer = null;
            currentIdx = 0;
            
            document.getElementById('learnBtn').className = appMode === 'learn' 
                ? 'flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-green-600 text-white'
                : 'flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-gray-100 text-gray-700 hover:bg-gray-200';
            
            document.getElementById('quizBtn').className = appMode === 'quiz'
                ? 'flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-green-600 text-white'
                : 'flex-1 py-1.5 px-3 rounded-lg text-sm font-medium transition bg-gray-100 text-gray-700 hover:bg-gray-200';
            
            render();
        }

        function goNext() {
            if (currentIdx < questions.length - 1) {
                currentIdx++;
                isAnswered = false;
                shuffledOptions = [];
                render();
            }
        }

        function goPrev() {
            if (currentIdx > 0) {
                currentIdx--;
                isAnswered = false;
                shuffledOptions = [];
                render();
            }
        }

        function selectAnswer(ans) {
            userAnswer = ans;
            const correct = (userAnswer === questions[currentIdx].answer);
            isAnswered = true;
            render();
            
            if (correct) {
                correctCount++;
                totalCount++;
                setTimeout(() => {
                    if (currentIdx < questions.length - 1) {
                        currentIdx++;
                        isAnswered = false;
                        userAnswer = null;
                        shuffledOptions = [];
                        render();
                    }
                }, 800);
            } else {
                totalCount++;
            }
        }

        function retry() {
            isAnswered = false;
            userAnswer = null;
            shuffledOptions = [];
            render();
        }

        function resetApp() {
            currentIdx = 0;
            isAnswered = false;
            correctCount = 0;
            totalCount = 0;
            userAnswer = null;
            shuffledOptions = [];
            render();
        }

        render();
    </script>
</body>
</html>